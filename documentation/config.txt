ConeZ Configuration System
==========================

All device settings (WiFi credentials, GPS origin, LoRa radio parameters,
timezone, debug defaults, startup script) are configurable via an INI file
stored on the LittleFS flash filesystem.


Config File
-----------

Path: /config.ini on LittleFS

The file is optional. If it does not exist, all settings use compiled
defaults. Only settings you want to override need to be present — missing
keys silently fall back to defaults.

An example file with all keys and their defaults is provided at:
  firmware/data/config.ini.example


File Format
-----------

Standard INI format with [section] headers and key=value pairs.
Blank lines and lines starting with # or ; are ignored as comments.
Whitespace around the = sign is trimmed.

  [section]
  key=value
  key = value       ; also valid


Sections and Keys
-----------------

[wifi]
  ssid              WiFi network name              (default: RN-ConeZ)
  password          WiFi password                  (default: conezconez)

[gps]
  origin_lat        Origin latitude in degrees     (default: 40.762173)
  origin_lon        Origin longitude in degrees    (default: -119.193672)

[lora]
  ssid              LoRa network identifier        (default: ConeZ)
  frequency         Frequency in MHz               (default: 431.250)
  bandwidth         Bandwidth in kHz               (default: 500.0)
  sf                Spreading factor (7-12)        (default: 9)
  cr                Coding rate (5-8)              (default: 6)
  preamble          Preamble symbols               (default: 8)
  tx_power          Transmit power in dBm          (default: 10)
  sync_word         Sync word, hex format          (default: 0x12)
                      0x12 = LoRa default
                      0x1424 = LoRa private network
  callsign          Ham radio callsign             (default: empty)
                      License ID for 70cm band operation.
  rf_mode           Radio mode: "lora" or "fsk"    (default: lora)
                      Selects LoRa spread-spectrum or FSK narrowband.
                      config set requires reboot; "lora mode" hot-applies.
  fsk_bitrate       FSK bit rate in kbps           (default: 4.8)
                      Range 0.6-300.
  fsk_freqdev       FSK frequency deviation in kHz (default: 5.0)
                      Range 0.6-200.
  fsk_rxbw          FSK RX bandwidth in kHz        (default: 156.2)
                      Discrete set: 4.8, 5.8, 7.3, 9.7, 11.7, 14.6,
                      19.5, 23.4, 29.3, 39.0, 46.9, 58.6, 78.2, 93.8,
                      117.3, 156.2, 187.2, 234.3, 312.0, 373.6, 467.0.
  fsk_shaping       FSK data shaping               (default: 0)
                      0=none, 1=BT0.3, 2=BT0.5, 3=BT0.7, 4=BT1.0.
  fsk_whitening     FSK data whitening             (default: off)
  fsk_syncword      FSK sync word as hex string    (default: 12AD)
                      2-16 hex characters (1-8 bytes).
  fsk_crc           FSK CRC mode                   (default: 2)
                      0=off, 1=1-byte CRC, 2=2-byte CRC.

[system]
  device_name       DHCP hostname (blank = auto)   (default: empty)
                      When empty, hostname is auto-generated as
                      ConeZ-XXYY from the last 2 bytes of the MAC address.
  startup_script    Script to auto-run at boot       (default: auto-detect)
                      When empty (default), searches for /startup.bas,
                      /startup.c, /startup.wasm in order (only candidates
                      whose runtime is compiled in). Set explicitly to
                      override auto-detection.
  timezone          Standard (winter) UTC offset   (default: -8)
                      Set to the non-DST offset for your zone (e.g. -8 for PST).
                      When auto_dst is on, +1 is added automatically during DST.
  auto_dst          Automatic US DST adjustment    (default: on)
                      When on, adds +1 to timezone during US daylight saving
                      time (2nd Sunday of March – 1st Sunday of November).
                      Turn off for Arizona, Hawaii, or international use.
  cone_id           Unique cone identifier (0-4095) (default: 0)
                      Used by the cue system for per-cone targeting.
  cone_group        Cone group number (0-4095)      (default: 0)
                      Used by the cue system for group-based targeting.
  ntp_server        NTP server hostname            (default: empty)
                      When empty, uses pool.ntp.org. Set to a local NTP
                      server address for minimal network latency at
                      installations (e.g. 192.168.1.100).

[led]
  count1            LEDs on channel 1              (default: 50)
  count2            LEDs on channel 2              (default: 50)
  count3            LEDs on channel 3              (default: 50)
  count4            LEDs on channel 4              (default: 50)

  LED buffers are dynamically allocated at boot based on these values.
  config set requires reboot; "led count" hot-applies.

[debug]
  system            System messages                (default: on)
  basic             BASIC interpreter output       (default: on)
  wasm              WASM runtime output            (default: on)
  commands          CLI command output             (default: on)
  gps               GPS position updates           (default: off)
  gps_raw           Raw NMEA sentences             (default: off)
  lora              LoRa packet events             (default: off)
  lora_raw          Raw LoRa data                  (default: off)
  fsync             Frame sync messages            (default: off)
  wifi              WiFi events                    (default: off)
  sensors           Sensor readings                (default: off)
  other             Uncategorized messages          (default: off)

Boolean values accept: on/off, true/false, 1/0
Integer values accept decimal (18) or hex (0x12) format.


CLI Commands
------------

  config
      Show all current settings and their values.

  config set section.key value
      Set a configuration value and save to flash.
      Debug settings take effect immediately.
      All other settings require a reboot.
      Examples:
        config set wifi.ssid MyNetwork
        config set lora.sync_word 0x1424
        config set debug.gps on

  config unset section.key
      Revert a single key to its compiled default and save.
      Examples:
        config unset wifi.ssid
        config unset lora.frequency

  config reset
      Delete /config.ini and revert all settings to compiled defaults.
      Debug settings take effect immediately; reboot for the rest.


Boot Sequence
-------------

The config system loads early in setup(), after LittleFS is mounted but
before any hardware that depends on config values is initialized:

  init_LittleFS()          LittleFS available
  list_dir()
  config_init()            Load defaults, overlay from /config.ini
  cue_setup()              Initialize cue engine (no file loaded yet)
  led_setup()              Allocates LED buffers from config.led_count*
  Wire.begin()
  lora_setup()             Reads config.lora_*
  gps_setup()              Reads config.origin_*
  sensors_setup()
  WiFi.begin()             Reads config.wifi_*
  ntp_setup()              Starts SNTP if WiFi connected
  printManagerInit()
  config_apply_debug()     Applies config.dbg_* settings
  sunSetTZOffset()         Reads config.timezone
  setup_basic()            Starts BASIC task on Core 0 (if INCLUDE_BASIC)
  setup_wasm()             Starts WASM task on Core 0 (if INCLUDE_WASM)
  script_autoexec()        Runs startup script (configured or auto-detected)


Adding a New Config Key
-----------------------

1. Add the field to conez_config_t in config.h
2. Add a DEFAULT_* constant in config.h
3. Add a CFG_ENTRY() row to cfg_table[] in config.cpp
4. Add the default assignment in config_fill_defaults() in config.cpp
5. Use config.field_name in the consuming code

The descriptor table drives parsing, saving, display, set, and unset
automatically — no per-field logic needed anywhere else.

Available types: CFG_STR, CFG_FLOAT, CFG_INT, CFG_HEX, CFG_BOOL
